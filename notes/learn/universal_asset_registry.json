{
    "meta": {
      "version": "3.2.0",
      "description": "Visual Asset OS Core Registry - The DNA of the Universe"
    },
  
    "//_comment_system_rules": "系统物理法则：定义连线与节点的交互逻辑",
    "system_rules": {
      "solid_line": {
        "meaning": "Process / Production",
        "behavior": "1-to-1 only. Triggers a Recipe. Creates a new Asset version."
      },
      "dashed_line": {
        "meaning": "Reference / Shortcut",
        "behavior": "Many-to-1. No processing. Adds asset to a Collection/Context."
      },
      "isolation": "Unconnected nodes are Raw Materials or Archives."
    },
  
    "//_comment_ui_config": "视觉风格定义：让前端渲染知道用什么颜色区分不同类型的节点",
    "ui_config": {
      "category_styles": {
        "media": { "color": "#3b82f6", "shape": "rounded_rect", "label_color": "#eff6ff" },    
        "creative": { "color": "#a855f7", "shape": "note_card", "label_color": "#f3e8ff" },   
        "world": { "color": "#22c55e", "shape": "hexagon", "label_color": "#f0fdf4" },        
        "ai_flow": { "color": "#f97316", "shape": "dashed_border", "label_color": "#fff7ed" }, 
        "org": { "color": "#64748b", "shape": "folder_tab", "label_color": "#f8fafc" }        
      },
      "connection_styles": {
        "solid": { "stroke": "#cbd5e1", "width": 2, "animate_on_process": true },
        "dashed": { "stroke": "#94a3b8", "width": 1, "dash_array": "5 5" }
      }
    },
  
    "//_comment_categories": "UI 菜单生成依据",
    "categories": [
      { "id": "media", "label": "媒体 (Media)", "icon": "image" },
      { "id": "creative", "label": "创意 (Creative)", "icon": "pen-tool" },
      { "id": "world", "label": "世界构建 (World)", "icon": "globe" },
      { "id": "ai_flow", "label": "AI 工作流 (AI Workflow)", "icon": "cpu" },
      { "id": "org", "label": "组织 (Organization)", "icon": "folder" }
    ],
  
    "//_comment_agents": "工人名录：定义配方背后的执行者及其能力边界，解耦定义与执行",
    "agents": {
      "sd_agent": {
        "name": "Stable Diffusion Backend",
        "type": "remote_api",
        "endpoint": "http://127.0.0.1:7860",
        "concurrency": 1,
        "timeout_seconds": 60,
        "retry_policy": "exponential_backoff"
      },
      "rembg_agent": {
        "name": "Background Remover",
        "type": "local_python_module",
        "module_path": "agents.vision.rembg_worker",
        "device": "gpu"
      },
      "llm_agent": {
        "name": "Local LLM (Ollama)",
        "type": "remote_api",
        "endpoint": "http://localhost:11434",
        "model_target": "mistral"
      },
      "system_zip": {
        "name": "System Archiver",
        "type": "native_os_call",
        "command": "zip -r"
      }
    },
  
    "//_comment_mixins": "能力原子：可被注入到任何资产的通用属性包",
    "mixins": {
      "file_source": {
        "label": "文件源",
        "properties": {
          "src": { "type": "string", "ui_hints": { "widget": "file_upload" } },
          "mime_type": { "type": "string", "ui_hints": { "readonly": true } },
          "size": { "type": "computed", "expression": "this.src ? (this.src.length/1024).toFixed(2)+'KB' : '0KB'" }
        }
      },
      "physical_props": {
        "label": "物理属性",
        "properties": {
          "weight": { "type": "number", "default": 1.0, "label": "Weight (kg)" },
          "durability": { "type": "number", "default": 100, "ui_hints": { "widget": "slider", "max": 100 } }
        }
      },
      "rpg_stats": {
        "label": "RPG 数值",
        "properties": {
          "hp": { "type": "number", "default": 100 },
          "mp": { "type": "number", "default": 50 },
          "level": { "type": "number", "default": 1 }
        }
      },
      "ai_params": {
        "label": "AI 生成参数",
        "properties": {
          "seed": { "type": "number", "default": -1, "label": "随机种子" },
          "steps": { "type": "number", "default": 20 },
          "cfg_scale": { "type": "number", "default": 7.0 }
        }
      }
    },
  
    "//_comment_types": "万物定义：节点类型",
    "types": {
      "//--- 1. 抽象基类 ---": "",
      "base_asset": {
        "abstract": true,
        "properties": {
          "name": { 
            "type": "string", 
            "rules": [{ "required": true }], 
            "ui_hints": { "widget": "text_input", "placeholder": "Untitled Asset" }
          },
          "description": { "type": "string", "ui_hints": { "widget": "textarea", "rows": 2 } },
          "tags": { "type": "array", "ui_hints": { "widget": "tag_picker" } },
          "created_at": { "type": "computed", "expression": "Date.now()" }
        }
      },
  
      "//--- 2. 媒体资产 (Media) ---": "",
      "image_asset": {
        "extends": "base_asset",
        "category": "media",
        "mixins": ["file_source"],
        "properties": {
          "resolution": { "type": "string", "ui_hints": { "readonly": true } }
        }
      },
      "video_asset": {
        "extends": "base_asset",
        "category": "media",
        "mixins": ["file_source"],
        "properties": {
          "duration": { "type": "number", "label": "Duration (sec)" },
          "fps": { "type": "number", "default": 30 }
        }
      },
      "document_asset": {
        "extends": "base_asset",
        "category": "media",
        "mixins": ["file_source"],
        "properties": {
          "page_count": { "type": "number" },
          "text_content": { "type": "string", "label": "Extracted Text", "ui_hints": { "widget": "textarea", "readonly": true } }
        }
      },
  
      "//--- 3. 创意资产 (Creative) ---": "",
      "text_asset": {
        "extends": "base_asset",
        "category": "creative",
        "properties": {
          "content": { "type": "string", "ui_hints": { "widget": "markdown_editor", "rows": 6 } }
        }
      },
      "prompt_asset": {
        "extends": "text_asset",
        "category": "creative",
        "description": "专用于 AI 生成的提示词，包含正负向",
        "properties": {
          "negative_prompt": { "type": "string", "ui_hints": { "widget": "textarea", "placeholder": "Negative prompt..." } },
          "weight": { "type": "number", "default": 1.0, "ui_hints": { "widget": "slider", "step": 0.1, "max": 2 } }
        }
      },
      "style_preset": {
        "extends": "base_asset",
        "category": "creative",
        "mixins": ["ai_params"],
        "description": "AI 风格预设卡 (LORA, Checkpoint 配置)",
        "properties": {
          "base_model": { "type": "string", "default": "SDXL_1.0" },
          "lora_weights": { "type": "object", "ui_hints": { "widget": "json_editor" } }
        }
      },
  
      "//--- 4. 组织资产 (Organization) ---": "",
      "collection_asset": {
        "extends": "base_asset",
        "category": "org",
        "properties": {
          "members": { "type": "array_reference", "ui_hints": { "widget": "grid_view", "readonly": true } },
          "max_size": { "type": "number", "default": 999 }
        }
      },
      "generation_context": {
        "extends": "collection_asset",
        "category": "ai_flow",
        "description": "生成任务包：将 Prompt、参考图、风格预设打包在一起",
        "properties": {
          "batch_size": { "type": "number", "default": 1 }
        }
      },
      "struct_asset": {
        "extends": "base_asset",
        "category": "org",
        "description": "自定义对象：用户可在画布上动态添加字段",
        "properties": {
          "dynamic_fields": { "type": "object", "ui_hints": { "widget": "key_value_builder" } }
        }
      },
  
      "//--- 5. 世界构建 (World) ---": "",
      "character": {
        "extends": "base_asset",
        "category": "world",
        "mixins": ["rpg_stats"],
        "properties": {
          "age": { "type": "number" },
          "avatar": { "type": "connection", "accepts": ["image_asset"] },
          "inventory": { "type": "connection", "accepts": ["collection_asset"] }
        }
      },
      "location": {
        "extends": "base_asset",
        "category": "world",
        "properties": {
          "environment": { "type": "string", "ui_hints": { "widget": "select", "options": ["Indoor", "Urban", "Nature", "Space"] } },
          "concept_art": { "type": "connection", "accepts": ["image_asset"] }
        }
      }
    },
  
    "//_comment_recipes": "动词定义：输入什么 -> Agent -> 输出什么",
    "recipes": {
      "ai_txt2img": {
        "label": "AI 生图 (Text to Image)",
        "agent": "sd_agent",
        "category": "AI Generation",
        "type": "heavy",
        "input_schema": { "type": "generation_context", "required_keys": ["content"] }, 
        "output_schema": { "type": "image_asset" }
      },
      "ai_img2img": {
        "label": "AI 图生图 (Image to Image)",
        "agent": "sd_agent",
        "category": "AI Generation",
        "type": "heavy",
        "input_schema": { "type": "generation_context", "required_keys": ["content", "primary_source"] },
        "output_schema": { "type": "image_asset" }
      },
      "remove_bg": {
        "label": "智能抠图",
        "agent": "rembg_agent",
        "category": "Image Tools",
        "type": "heavy",
        "input_schema": { "type": "image_asset" },
        "output_schema": { "type": "image_asset" }
      },
      "summarize_doc": {
        "label": "文档摘要 (Summarize)",
        "agent": "llm_agent",
        "category": "Text Tools",
        "type": "heavy",
        "input_schema": { "type": "document_asset" },
        "output_schema": { "type": "text_asset" }
      },
      "extract_prompt": {
        "label": "反推提示词 (Interrogate CLIP)",
        "agent": "clip_agent",
        "category": "AI Tools",
        "type": "heavy",
        "input_schema": { "type": "image_asset" },
        "output_schema": { "type": "prompt_asset" }
      },
      "pack_zip": {
        "label": "打包压缩 (Zip)",
        "agent": "system_zip",
        "category": "Tools",
        "type": "light",
        "input_schema": { "type": "collection_asset" },
        "output_schema": { "type": "document_asset", "subtype": "archive" }
      }
    }
  }