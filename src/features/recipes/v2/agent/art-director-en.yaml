# Art Director - V2 Format (English)
version: 2

id: art-director-en
name: Art Director
description: Generate executable AI image prompts with color injection for the production manifest
category: Agent
icon: Palette

# ============================================================================
# Input Form
# ============================================================================
input:
  - key: productionManifest
    label: Production Manifest
    type: array
    widget: table-input
    required: true
    connection: input
    placeholder: "Connect the 'Production Manifest' table here"
    schema:
      - key: assetId
        label: Asset ID
        type: string
        widget: text
        required: true
      - key: name
        label: Name
        type: string
        widget: text
        required: true
      - key: visualStyle
        label: Visual Style
        type: string
        widget: text

  - key: soulProfile
    label: Soul Profile
    type: object
    widget: form-input
    required: true
    connection: input
    placeholder: "Connect the 'Soul Profile' JSON here"
    schema:
      - key: name
        label: Name
        type: string
        widget: text
        required: true
      - key: tagline
        label: Tagline
        type: string
        widget: text
      - key: colorDNA
        label: Color DNA
        type: object
        widget: form-input
        schema:
          - key: primary
            label: Primary
            type: string
            widget: color-picker
          - key: secondary
            label: Secondary
            type: string
            widget: color-picker
          - key: accent
            label: Accent
            type: string
            widget: color-picker

  - key: styleTemplate
    label: Visual Style Template
    type: object
    widget: form-input
    required: true
    connection: input
    placeholder: "Pass style template (use SelectorNode to choose)"
    schema:
      - key: name
        label: Style Name
        type: string
        widget: text
        required: true
      - key: style
        label: Style Description
        type: string
        widget: textarea
      - key: lighting
        label: Lighting
        type: string
        widget: text
      - key: mood
        label: Mood
        type: string
        widget: text

  - key: assetDefinitions
    label: Asset Definitions
    type: array
    widget: table-input
    required: true
    connection: input
    placeholder: "Pass asset definitions JSON (built with TableNode)"
    schema:
      - key: id
        label: ID
        type: string
        widget: text
        required: true
      - key: name
        label: Name
        type: string
        widget: text
        required: true
      - key: description
        label: Description
        type: string
        widget: textarea
      - key: category
        label: Category
        type: string
        widget: text

# ============================================================================
# Model Requirements
# ============================================================================
model:
  category: llm
  capabilities:
    - chat
  defaultParams:
    temperature: 0.7
    maxTokens: 8192

# ============================================================================
# Prompt Templates
# ============================================================================
prompt:
  system: |
    You are the Art Director (Agent D) of the Soulmate Protocol.
    Your job is to translate business requirements into EXECUTABLE IMAGE PROMPTS.

    【VISUAL ASSET DEFINITIONS】
    The following asset types and prompt templates come from the user-provided asset definitions:
    
    {{assetDefinitions}}
    
    Parse the id, promptTemplate, aspectRatio, and recommendedResolution fields.

    【VISUAL STYLE TEMPLATE】
    Current selected style template:
    
    {{styleTemplate}}
    
    Extract the promptModifier (style keywords) for injection.

    【YOUR CORE FORMULA】
    For each item in the Production Manifest, construct the Final Prompt using this formula:
    
    `[Style Keywords] + [Base Template] + [Character Visual DNA] + [Color Injection] + [--ar AspectRatio]`

    **KEY INJECTION RULES:**
    1. **Style Injection**: Start with the style template's promptModifier.
    2. **Visual Anchor**: Extract visualDNA from Soul Profile to describe the character's appearance.
    3. **Color Injection** - VERY IMPORTANT!
       - Extract primaryColor, secondaryColor, accentColor, backgroundColor from Soul Profile
       - Forcefully apply these colors to character outfit, UI elements, and backgrounds
       - Use format like: "outfit in [primaryColor] with [accentColor] accents, [backgroundColor] background"
    4. **Template Integration**: Use the promptTemplate from asset definitions as the base structure.
    5. **Text Ban**: NEVER render text, logos, or typography.

    【OUTPUT FORMAT】
    Return a JSON Array.
    Format:
    [
      {
        "assetId": "character-main",
        "assetName": "Key Visual",
        "resolution": "4K",
        "aspectRatio": "1:1",
        "finalPrompt": "[style keywords], [template], [character description], [color injection], --ar 1:1",
        "microCopy": "Micro-copy passed from production manifest (if any)"
      },
      ...
    ]

    【CRITICAL】
    - Return ONLY valid JSON.
    - Every prompt MUST include color injection.
    - Pass through microCopy from the production manifest for downstream use.
    - Ensure character-main is generated first.

  user: |
    Create the Visual Blueprint.
    
    **Soul Profile:**
    {{soulProfile}}
    
    **Production Manifest:**
    {{productionManifest}}
    
    Strictly apply color injection to ensure all assets use consistent brand colors.

# ============================================================================
# Output Definition
# ============================================================================
output:
  format: json
  node: table
  title: "Visual Blueprint ({{count}} prompts)"
  collapsed: false
  config:
    columns:
      - key: assetId
        label: Asset ID
        type: string
        hidden: true
      - key: assetName
        label: Asset
        type: string
      - key: finalPrompt
        label: Prompt
        type: string
      - key: resolution
        label: Res
        type: string
      - key: aspectRatio
        label: AR
        type: string
      - key: microCopy
        label: Micro-Copy
        type: string

# ============================================================================
# Advanced Options
# ============================================================================
advanced:
  multiTurn: true

