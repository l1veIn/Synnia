# 艺术总监 - V2 Format
version: 2

id: art-director
name: 艺术总监
description: 为生产清单生成可执行的AI图像提示词（含色彩注入）
category: Agent
icon: Palette

# ============================================================================
# Input Form
# ============================================================================
input:
  - key: productionManifest
    label: 生产清单
    type: array
    widget: table-input
    required: true
    connection: input
    placeholder: "在此连接'生产清单'表格"
    schema:
      - key: assetId
        label: 资产ID
        type: string
        widget: text
        required: true
      - key: name
        label: 名称
        type: string
        widget: text
        required: true
      - key: visualStyle
        label: 视觉风格
        type: string
        widget: text

  - key: soulProfile
    label: 灵魂档案
    type: object
    widget: form-input
    required: true
    connection: input
    placeholder: "在此连接'灵魂档案'JSON"
    schema:
      - key: name
        label: 名称
        type: string
        widget: text
        required: true
      - key: tagline
        label: 标语
        type: string
        widget: text
      - key: colorDNA
        label: 色彩DNA
        type: object
        widget: form-input
        schema:
          - key: primary
            label: 主色
            type: string
            widget: color
          - key: secondary
            label: 辅助色
            type: string
            widget: color
          - key: accent
            label: 强调色
            type: string
            widget: color

  - key: styleTemplate
    label: 视觉风格模板
    type: object
    widget: form-input
    required: true
    connection: input
    placeholder: "传入风格模板 (可用 SelectorNode 选择)"
    schema:
      - key: name
        label: 风格名称
        type: string
        widget: text
        required: true
      - key: style
        label: 风格描述
        type: string
        widget: textarea
      - key: lighting
        label: 光照
        type: string
        widget: text
      - key: mood
        label: 氛围
        type: string
        widget: text

  - key: assetDefinitions
    label: 资产定义库
    type: array
    widget: table-input
    required: true
    connection: input
    placeholder: "传入资产定义 JSON (可用 TableNode 构建)"
    schema:
      - key: id
        label: ID
        type: string
        widget: text
        required: true
      - key: name
        label: 名称
        type: string
        widget: text
        required: true
      - key: description
        label: 描述
        type: string
        widget: textarea
      - key: category
        label: 类别
        type: string
        widget: text

# ============================================================================
# Model Requirements
# ============================================================================
model:
  category: llm
  capabilities:
    - chat
  defaultParams:
    temperature: 0.7
    maxTokens: 8192

# ============================================================================
# Prompt Templates
# ============================================================================
prompt:
  system: |
    你是 Soulmate Protocol 的艺术总监（Agent D）。
    你的工作是将业务需求转化为可执行的图像提示词。

    【视觉资产定义库】
    以下是资产类型及其提示词模板，来自用户提供的资产定义库：
    
    {{assetDefinitions}}
    
    解析其中的 id、promptTemplate、aspectRatio、recommendedResolution 字段。

    【视觉风格模板】
    当前选择的风格模板：
    
    {{styleTemplate}}
    
    提取其中的 promptModifier（风格关键词）用于注入。

    【你的核心公式】
    对于生产清单中的每个项目，使用此公式构建最终提示词：
    
    `[风格关键词] + [基础模板] + [角色视觉DNA] + [色彩注入] + [--ar 宽高比]`

    **关键注入规则：**
    1. **Style Injection（风格注入）**：以风格模板的 promptModifier 开头。
    2. **Visual Anchor（视觉锚定）**：从灵魂档案提取 visualDNA，描述角色外貌。
    3. **Color Injection（色彩注入）** - 非常重要！
       - 从灵魂档案中提取 primaryColor、secondaryColor、accentColor、backgroundColor
       - 强制将这些颜色应用到角色服装、UI元素和背景中
       - 使用格式如："outfit in [primaryColor] with [accentColor] accents, [backgroundColor] background"
    4. **Template Integration**：使用资产定义库中对应资产的 promptTemplate 作为基础结构。
    5. **Text Ban**：绝不渲染文字、Logo或排版。

    【输出格式】
    返回一个JSON数组。
    格式：
    [
      {
        "assetId": "character-main",
        "assetName": "核心主视觉",
        "resolution": "4K",
        "aspectRatio": "1:1",
        "finalPrompt": "[风格关键词], [模板], [角色描述], [色彩注入], --ar 1:1",
        "microCopy": "从生产清单传递的微文案（如有）"
      },
      ...
    ]

    【关键要求】
    - 只返回有效的JSON。
    - 每条提示词都必须包含色彩注入。
    - microCopy 从生产清单中传递，用于后续使用。
    - 确保 character-main 是第一个生成的资产。

  user: |
    创建视觉蓝图。
    
    **灵魂档案：**
    {{soulProfile}}
    
    **生产清单：**
    {{productionManifest}}
    
    请严格应用色彩注入，确保所有资产使用一致的品牌配色。

# ============================================================================
# Output Definition
# ============================================================================
output:
  format: json
  node: table
  title: "视觉蓝图 ({{count}} 条提示词)"
  collapsed: false
  config:
    columns:
      - key: assetId
        label: 资产ID
        type: string
        hidden: true
      - key: assetName
        label: 资产
        type: string
      - key: finalPrompt
        label: 提示词
        type: string
      - key: resolution
        label: 分辨率
        type: string
      - key: aspectRatio
        label: 宽高比
        type: string
      - key: microCopy
        label: 微文案
        type: string

# ============================================================================
# Advanced Options
# ============================================================================
advanced:
  multiTurn: true

